File automatically generated by build-doc.sh and ./bin/mm.exe, do not edit manually.

# Compilation

Download and build dependencies with following command:
- ./build.sh deps

Build software with following command:
- ./build.sh [release|debug] [noomp] [nojobs]
- release|debug: sets build target (release is default)
- noomp: disables openmp build
- nojobs: disables multi-processor build on unix (i.e. use -j 1)
- output binary produced in bin folder.

Update readme with following command:
- ./build.sh doc
- output readme.md

# Usage examples

Note: 
- the system can read/write point clouds as obj or ply format.
- the system can read/write meshes as obj or ply format.
- once a file loaded the system detects a mesh by checking if any topology is avilable.

## Simple commands

Sample input.obj into output.ply using subdivision mode (sdiv).

```
mm.exe sample --mode sdiv -i input.obj --areaThreshold=1.0 --mapThreshold -o output.ply 
```

Compare textured meshB.obj mesh against meshA reference mesh using pcc_error. Will use default sampling method.

```
mm.exe compare --mode pcc --inputModelA inputA.obj --inputMapA mapA.png  --inputModelB inputB.obj --inputMapB mapB.png
```

## Commands combination

Following example uses specific grid sampling method, then compare using pcc_error and pcqm metrics in a single call.

```
mm.exe \
	sample --mode grid -i inputA.obj -m mapA.png -o ID:pcA END \
	sample --mode grid -i inputB.obj -m mapB.png -o ID:pcB END \
	compare --mode pcc  --inputModelA ID:pcA --inputModelB ID:pcB END \
	compare --mode pcqm --inputModelA ID:pcA --inputModelB ID:pcB
```

Same as previous but dumping intermediate sampling results into files. Compare still use the versions in memory.

```
mm.exe \
	sample --mode grid -i inputA.obj -m mapA.png -o pcA.ply END \
	sample --mode grid -i inputB.obj -m mapB.png -o pcB.ply END \
	compare --mode pcc  --inputModelA pcA.ply --inputModelB pcB.ply END \
	compare --mode pcqm --inputModelA pcA.ply --inputModelB pcB.ply END \
```

Several commands can be cascaded using this mechanism, for instance doing quantization then sampling then compare. 
Note however that memory won't be released between sub command calls so cascading many commands may be very consuming in terms of memory.

## Sequence processing

Following sample demonstrates how to execute commands on a numerated sequence of objects ranging from 00150 to 00165 included. 
The "%3d" part of the file names will be replaced by the frame number ranging from firstFrame to lastFrame, coded on 3 digits.

```
mm.exe \
	sequence --firstFrame 150 --lastFrame 165
	sample --mode grid -i inputA_00%3d.obj -m mapA_00%3d.png -o ID:pcA END \
	sample --mode grid -i inputB_00%3d.obj -m mapB_00%3d.png -o ID:pcB END \
	compare --mode pcc  --inputModelA ID:pcA --inputModelB ID:pcB END \
	compare --mode pcqm --inputModelA ID:pcA --inputModelB ID:pcB
```

The replacement mechanism can also be used on final or intermediate output file names as shown in the two following examples.

```
mm.exe \
	sequence --firstFrame 150 --lastFrame 165
	sample --mode grid -i input_00%3d.obj -m map_00%3d.png -o output_00%3d_pcloud.obj
```

```
mm.exe \
	sequence --firstFrame 150 --lastFrame 165
	quantize --qp 12  -i input_00%3d.obj -o quantized_%3d.obj
	sample --mode grid -i quantized_%3d.obj -m map_00%3d.png -o pcloud_00%3d.obj
```

The following statement will perform an analysis of the frames of a sequence and ouput a summary into file globals.txt. This
text file can then be directly sourced by bash to access the variables and reinject into quantization command for instance. 
In the following example, the extremums (Position bounding box, normal bounding box and uv bounding box) computed for the entire 
sequence by analyse will be used as the quantization range for each frame by the quantize sequence.

```
mm.exe \
	sequence --firstFrame 150 --lastFrame 165 ENd \
	analyse --inputModel input_00%3d.obj --outputVar globals.txt

# load result in memory
source globals.txt

mm.exe \
	sequence --firstFrame 150 --lastFrame 165 END \
	quantize --inputModel input_00%3d.obj  --outputModel=output_00%3d.obj \
		--qp 12 --qt 12 --qn 10
		--minPos="${globalMinPos}" --maxPos="${globalMaxPos}" \
		--minUv="${globalMinUv}"   --maxUv="${globalMaxUv}" \
		--minNrm="${globalMinNrm}" --maxNrm="${globalMaxNrm}"
	
```
# Command references

```
3D model processing commands v1.0.1
Usage:
  mm.exe command [OPTION...]

Command help:
  mm.exe command --help

Command:
  analyse	Analyse model and/or texture map
  compare	Compare model A vs model B
  degrade	Degrade a mesh (todo points)
  dequantize	Dequantize model (mesh or point cloud) 
  normals	Computes the mesh normals.
  quantize	Quantize model (mesh or point cloud)
  reindex	Reindex mesh and optionaly sort vertices and face indices
  render	Render a mesh (todo points)
  sample	Convert mesh to point cloud
  sequence	Sequence global parameters

```

## Analyse

```
Analyse model and/or texture map
Usage:
  mm.exe analyse [OPTION...]

      --inputModel arg  path to input model (obj or ply file)
      --inputMap arg    path to input texture map (png, jpeg)
      --outputCsv arg   optional path to output results file
      --outputVar arg   optional path to output variables file
  -h, --help            Print usage

```

## Compare

```
Compare model A vs model B
Usage:
  mm.exe compare [OPTION...]

      --inputModelA arg   path to reference input model (obj or ply file)
      --inputModelB arg   path to distorted input model (obj or ply file)
      --inputMapA arg     path to reference input texture map (png, jpg, rgb,
                          yuv)
      --inputMapB arg     path to distorted input texture map (png, jpg, rgb,
                          yuv)
      --outputModelA arg  path to output model A (obj or ply file)
      --outputModelB arg  path to output model B (obj or ply file)
      --outputCsv arg     filename of the file where per frame statistics
                          will append. (default: )
      --mode arg          the comparison mode in [equ,pcc,pcqm,topo,ibsm]
                          (default: equ)
  -h, --help              Print usage

 equ mode options:
      --epsilon arg  Used for point cloud comparison only. Distance threshold
                     in world units for "equality" comparison. If 0.0 use
                     strict equality (no distace computation). (default: 0.0)
      --earlyReturn  Return as soon as a difference is found (faster).
                     Otherwise provide more complete report (slower). (default:
                     true)
      --unoriented   If set, comparison will not consider faces orientation
                     for comparisons.

 ibsm mode options:
      --ibsmResolution arg      Resolution of the image buffer. (default:
                                2048)
      --ibsmCameraCount arg     Number of virtual cameras to be used per
                                frame. (default: 16)
      --ibsmCameraRotation arg  Three parameters of rotating the virtual
                                camera positions: the polar angle, the azimuthal
                                angle and the rotation magnitude (default: 0.0
                                0.0 0.0)
      --ibsmRenderer arg        Use software or openGL 1.2 renderer. Value in
                                [sw_raster, gl12_raster]. (default:
                                sw_raster)
      --ibsmDisableCulling      Set option to disable the backface culling.
      --ibsmDisableReordering   Set option to disable automatic oriented
                                reordering of input meshes, can be usefull if
                                already done previously to save very small
                                execution time.
      --ibsmOutputPrefix arg    Set option with a proper prefix/path system
                                to dump the color shots as png images (Warning,
                                it is extremly time consuming to write the
                                buffers, use only for debug).

 pcc mode options:
      --singlePass          Force running a single pass, where the loop is
                            over the original point cloud
      --hausdorff           Send the Haursdorff metric as well
      --color               Check color distortion as well (default: true)
      --resolution arg      Amplitude of the geometric signal. Will be
                            automatically set to diagonal of the models bounding box
                            if value = 0 (default: 0.0)
      --neighborsProc arg   0(undefined), 1(average), 2(weighted average)
                            3(min), 4(max) neighbors with same geometric distance
                            (default: 1)
      --dropDuplicates arg  0(detect), 1(drop), 2(average) subsequent points
                            with same coordinates (default: 2)
      --bAverageNormals     false(use provided normals), true(average normal
                            based on neighbors with same geometric distance)
                            (default: true)

 pcqm mode options:
      --radiusCurvature arg     Set a radius for the construction of the
                                neighborhood. As the bounding box is already
                                computed with this program, use proposed value.
                                (default: 0.001)
      --thresholdKnnSearch arg  Set the number of points used for the quadric
                                surface construction (default: 20)
      --radiusFactor arg        Set a radius factor for the statistic
                                computation. (default: 2.0)

 topo mode options:
      --faceMapFile arg    path to the topology text file matching modelB
                           topology (face) to modelA topology (face).
      --vertexMapFile arg  path to the topology text file matching modelB
                           topology (vertex) to modelA topology (vertex).

```

## Degrade

```
Degrade a mesh (todo points)
Usage:
  mm.exe degrade [OPTION...]

  -i, --inputModel arg   path to input model (obj or ply file)
  -o, --outputModel arg  path to output model (obj or ply file)
      --mode arg         the sampling mode in [delface]
      --nthFace arg      in delface mode, remove one face every nthFace.
                         (default: 50)
      --nbFaces arg      in delface mode, if nthFace==0, remove nbFaces.
                         (default: 0)
  -h, --help             Print usage

```
## Dequantize

```
Dequantize model (mesh or point cloud) 
Usage:
  mm.exe dequantize [OPTION...]

  -i, --inputModel arg        path to input model (obj or ply file)
  -o, --outputModel arg       path to output model (obj or ply file)
  -h, --help                  Print usage
      --qp arg                Geometry quantization bitdepth. No
                              dequantization of geometry if not set or < 7.
      --qt arg                UV coordinates quantization bitdepth. No
                              dequantization of uv coordinates if not set or < 7.
      --qn arg                Normals quantization bitdepth. No
                              dequantization of normals if not set or < 7.
      --qc arg                Colors quantization bitdepth. No dequantization
                              of colors if not set or < 7.
      --minPos arg            min corner of vertex position bbox, a string of
                              three floats. Mandatory if qp set and >= 7
      --maxPos arg            max corner of vertex position bbox, a string of
                              three floats. Mandatory if qp set and >= 7
      --minUv arg             min corner of vertex texture coordinates bbox,
                              a string of three floats. Mandatory if qt set
                              and >= 7
      --maxUv arg             max corner of vertex texture coordinates bbox,
                              a string of three floats. Mandatory if qt set
                              and >= 7
      --minNrm arg            min corner of vertex normal bbox, a string of
                              three floats. Mandatory if qn set and >= 7.
      --maxNrm arg            max corner of vertex normal bbox, a string of
                              three floats. Mandatory if qn set and >= 7
      --minCol arg            min corner of vertex colors bbox, a string of
                              three floats. Mandatory if qc set and >= 7
      --maxCol arg            max corner of vertex colors bbox, a string of
                              three floats. Mandatory if qc set and >= 7
      --useFixedPoint         interprets minPos and maxPos inputs as fixed
                              point 16.
      --colorSpaceConversion  Convert color space from YUV to RGB.

```
## Normals

```
Computes the mesh normals.
Usage:
  mm.exe normals [OPTION...]

  -i, --inputModel arg   path to input model (obj or ply file)
  -o, --outputModel arg  path to output model (obj or ply file)
  -h, --help             Print usage
      --normalized       generated normals are normalized (default: true)
      --noSeams          if enabled generation is slower but vertex located
                         on UV seams are properly used as one same vertex,
                         hence removing lighting seams. (default: true)

```
## Quantize

```
Quantize model (mesh or point cloud)
Usage:
  mm.exe quantize [OPTION...]

  -i, --inputModel arg        path to input model (obj or ply file)
  -o, --outputModel arg       path to output model (obj or ply file)
  -h, --help                  Print usage
      --dequantize            set to process dequantification at the ouput
      --qp arg                Geometry quantization bitdepth. A value < 7
                              means no quantization. (default: 12)
      --qt arg                UV coordinates quantization bitdepth.  A value
                              < 7 means no quantization. (default: 12)
      --qn arg                Normals quantization bitdepth. A value < 7 no
                              quantization. (default: 12)
      --qc arg                Colors quantization bitdepth. A value < 7 no
                              quantization. (default: 8)
      --minPos arg            min corner of vertex position bbox, a string of
                              three floats. Computed of not set.
      --maxPos arg            max corner of vertex position bbox, a string of
                              three floats. Computed of not set.
      --minUv arg             min corner of vertex texture coordinates bbox,
                              a string of three floats. Computed of not set.
      --maxUv arg             max corner of vertex texture coordinates bbox,
                              a string of three floats. Computed of not set.
      --minNrm arg            min corner of vertex normal bbox, a string of
                              three floats. Computed of not set.
      --maxNrm arg            max corner of vertex normal bbox, a string of
                              three floats. Computed of not set.
      --minCol arg            min corner of vertex color bbox, a string of
                              three floats. Computed of not set.
      --maxCol arg            max corner of vertex color bbox, a string of
                              three floats. Computed of not set.
      --outputVar arg         path to the output variables file.
      --useFixedPoint         internally convert the minPos and maxPos to
                              fixed point 16.
      --colorSpaceConversion  Convert color space from RGB to YUV.

```
## Reindex

```
Reindex mesh and optionaly sort vertices and face indices
Usage:
  mm.exe reindex [OPTION...]

  -i, --inputModel arg   path to input model (obj or ply file)
  -o, --outputModel arg  path to output model (obj or ply file)
  -h, --help             Print usage
      --sort arg         Sort method in none, vertices, oriented, unoriented.
                         (default: none)

```
## Render

```
Render a mesh (todo points)
Usage:
  mm.exe render [OPTION...]

  -i, --inputModel arg     path to input model (obj or ply file)
  -m, --inputMap arg       path to input texture map (png, jpeg)
  -o, --outputImage arg    path to output image (png file) (default:
                           output.png)
      --outputDepth arg    path to output depth RGBA png file with 32bit
                           float span on the four components. If empty string will
                           not save depth (default behavior).
      --renderer arg       Use software or openGL 1.2 renderer. Value in
                           [sw_raster, gl12_raster]. (default: sw_raster)
      --hideProgress       hide progress display in console for use by robot
  -h, --help               Print usage
      --width arg          Output image width (default: 1980)
      --height arg         Output image height (default: 1024)
      --bilinear           Set --bilinear=false to disable bilinear filtering
                           (default: true)
      --viewDir arg        the view direction, a string of three floats
                           (default: 0.0 0.0 1.0)
      --viewUp arg         the view up vector, a string of three floats
                           (default: 0.0 1.0 0.0)
      --bboxMin arg        bbox min corner, a string of three floats. If not
                           both bboxMin and bboxMax set, will compute
                           automatically.
      --bboxMax arg        bbox max corner, a string of three floats. If not
                           both bboxMin and bboxMax set, will compute
                           automatically.
      --clearColor arg     background color, a string of four int8, each
                           component in [0,255]. (default: 0 0 0 0)
      --enableLighting     enable the lighting if model has normals.
      --autoLightPosition  enable light position computation from bounding
                           sphere radius and lightAutoDir parameter.
      --lightAutoDir arg   if autoLightPosition is set, will compute light
                           position as boundingSphereCenter + lightAutoDir *
                           boundingSphereRadius. Default value stands for top
                           right sector. (default: 1 1 1)
      --enableCulling      enable back face culling.
      --cwCulling          true sets Clock Wise (cw) orientation for face
                           culling, Counter Clock Wise (ccw) otherwise. (default:
                           true)

```
## Sample

```
Convert mesh to point cloud
Usage:
  mm.exe sample [OPTION...]

  -i, --inputModel arg   path to input model (obj or ply file)
  -m, --inputMap arg     path to input texture map (png, jpg, rgb, yuv)
  -o, --outputModel arg  path to output model (obj or ply file)
      --mode arg         the sampling mode in [face,grid,map,sdiv,ediv,prnd]
      --hideProgress     hide progress display in console for use by robot
      --outputCsv arg    filename of the file where per frame statistics will
                         append. (default: )
  -h, --help             Print usage

 ediv mode options:
      --lengthThreshold arg  edge length limit to stop subdivision, used only
                             if > 0, otherwise resolution is used. (default:
                             0.0)

 face and ediv modes options:
      --resolution arg  integer value in [1,maxuint], step/edgeLength =
                        resolution / size(largest bbox side). In ediv mode, the
                        resolution is used only if lengthThreshold=0. (default:
                        1024)

 face mode options:
      --float          if set the processings and outputs will be float32,
                       int32 otherwise (default: true)
      --thickness arg  floating point value, distance to border of the face
                       (default: 0.0)

 grid mode options:
      --gridSize arg   integer value in [1,maxint], side size of the grid
                       (default: 1024)
      --useNormal      if set will sample only in the direction with the
                       largest dot product with the triangle normal
      --minPos arg     min corner of vertex position bbox, a string of three
                       floats.
      --maxPos arg     max corner of vertex position bbox, a string of three
                       floats.
      --useFixedPoint  interprets minPos and maxPos inputs as fixed point 16.

 grid, face, sdiv and ediv modes. options:
      --bilinear           if set, texture filtering will be bilinear,
                           nearest otherwise
      --nbSamplesMin arg   if set different from 0, the system will rerun the
                           sampling multiple times to find the best parameter
                           producing a number of samples in [nbAmplesMin,
                           nbSamplesMax]. This process is very time comsuming.
                           (default: 0)
      --nbSamplesMax arg   see --nbSamplesMin documentation. Must be > to
                           --nbSamplesMin. (default: 0)
      --maxIterations arg  Maximum number of iterations in sample count
                           constrained sampling, i.e. when --nbSampleMin > 0.
                           (default: 10)

 prnd mode options:
      --nbSamples arg  integer value specifying the traget number of points
                       in the output point cloud (default: 2000000)

 sdiv mode options:
      --areaThreshold arg  face area limit to stop subdivision (default: 1.0)
      --mapThreshold       if set will refine until face vertices texels are
                           distanced of 1 and areaThreshold reached

```
## Sequence

```
Sequence global parameters
Usage:
  mm.exe sequence [OPTION...]

      --firstFrame arg  Sets the first frame of the sequence, included.
                        (default: 0)
      --lastFrame arg   Sets the last frame of the sequence, included. Must
                        be >= to firstFrame. (default: 0)
  -h, --help            Print usage

```
